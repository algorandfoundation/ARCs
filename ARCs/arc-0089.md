---
arc: 89
title: ASA Metadata Registry
description: Singleton Application providing ASA metadata via Algod API or the AVM
author: Cosimo Bassi (@cusma)
discussions-to: https://github.com/algorandfoundation/ARCs/issues/356
status: Draft
type: Standards Track
category: Interface
sub-category: Asa
created: 2025-09-22
requires: 4, 28, 56, 82
extends: 3, 20, 62
replaces: 69
---

## Abstract

This ARC defines the interface and the implementation of a singleton Application
that provides Algorand Standard Assets metadata through the Algod API or the AVM.

## Motivation

Algorand Standard Assets (ASA) lack a dedicated metadata field on the Algorand ledger
for storing additional asset information.

Although it's generally not advisable to use Algorand as a distributed storage system
for data that could easily reside elsewhere, the absence of a native metadata store
on the ledger has led the ecosystem to adopt less-than-ideal solutions for discovering
and fetching off-chain asset data, involving the usage of an Indexer or external
infrastructure (such as IPFS), or hacking on the ASA RBAC roles to get asset metadata
mutability.

While storing huge data, such as images, off-chain is a practical (and recommended)
approach, smaller, more pertinent data should not incur the expenses, availability
challenges, and latency typically associated with external infrastructure.

This ARC establishes a standardized URI within the ASA URL field to solve this simple
use case: _directly retrieving ASA metadata using the Algod API or the AVM_.

## Specification

The keywords "**MUST**", "**MUST NOT**", "**REQUIRED**", "**SHALL**", "**SHALL NOT**",
"**SHOULD**", "**SHOULD NOT**", "**RECOMMENDED**", "**MAY**", and "**OPTIONAL**"
in this document are to be interpreted as described in <a href="https://datatracker.ietf.org/doc/html/rfc2119">RFC 2119</a>.

The data types (like `uint64`, `byte[]`, etc.) in this document are to be interpreted
as specified in [ARC-4](./arc-0004.md#types).

> Notes like this are non-normative.

### ASA Metadata Registry

The ASA Metadata Registry is an _immutable singleton_ Application that stores _mutable_
or _immutable_ Asset Metadata.

The trusted deployment of ASA Metadata Registry are:

| NETWORK  |            GENESIS HASH (`base64`)             | APP ID | CREATOR ADDRESS                                              |
|:---------|:----------------------------------------------:|:------:|:-------------------------------------------------------------|
| Main Net | `wGHE2Pwdvd7S12BL5FaOP20EGYesN73ktiC1qzkkit8=` | `TBD`  | `XODGWLOMKUPTGL3ZV53H3GZZWMCTJVQ5B2BZICFD3STSLA2LPSH6V6RW3I` |
| Test Net | `SGO1GKSzyE7IEPItTxCByw9x8FmnrCDexi9/cOUJOiI=` | `TBD`  | `TBD`                                                        |

> Refer to the [AppSpec section](#arc-56-appspec) for the detailed [ARC-56](./arc-0056.md)
> Application Specification of the singleton reference implementation.

The initial Minimum Balance Requirement (MBR) for the ASA Metadata Registry Application
Account **SHOULD** be provided _before_ enabling the creation of any Asset Metadata.

#### Asset Metadata Box

The ASA Metadata, along with some ancillary information, are stored in a dedicated
Box of the ASA Metadata Registry, called _Asset Metadata Box_.

There **MUST** be at most one Asset Metadata Box per ASA.

The Asset Metadata Box Name **MUST** be equal to the raw 8-byte big-endian encoding
of the _Asset ID_ (`uint64`).

The Asset Metadata Box Value **MUST** be defined as follows:

| FIELD                                               | SCOPE  |   TYPE   | BYTE OFFSET |         BYTE SIZE         |
|:----------------------------------------------------|:-------|:--------:|:-----------:|:-------------------------:|
| [Metadata Identifiers](#metadata-identifiers)       | Header |  `byte`  |     `0`     |            `1`            |
| [Metadata Flags](#metadata-flags)                   | Header |  `byte`  |     `1`     |            `1`            |
| [Last Modified Round](#last-modified-round)         | Header | `uint64` |     `2`     |            `8`            |
| [Last Modified Timestamp](#last-modified-timestamp) | Header | `uint64` |    `10`     |            `8`            |
| [Metadata](#metadata)                               | Body   | `byte[]` |    `18`     | up to `MAX_METADATA_SIZE` |

> See the [Metadata section](#metadata) for more details about the Metadata encoding
> and size limits.

#### Metadata Header

The Metadata Header is a byte-array of fixed length (`HEADER_SIZE`), encoding ancillary
attributes of the Asset Metadata.

The `HEADER_SIZE` (`uint16`) is a parameter of the ASA Metadata Registry that is
equal to the sum of the Header fields byte sizes (`18` bytes).

The `MAX_HEADER_SIZE` (`uint16`) is a parameter of the ASA Metadata Registry that
depends on:

- The AVM size of the `log` opcode `MAX_LOG_SIZE` (`1024` bytes);

- The [ARC-4](./arc-0004.md) return prefix (`151f7c75`) size `ARC4_RETURN_PREFIX_SIZE`
(`4` bytes);

Therefore, `MAX_HEADER_SIZE = MAX_LOG_SIZE - ARC4_RETURN_PREFIX_SIZE = 1020` bytes.

The `HEADER_SIZE` **MUST** hold the condition: `HEADER_SIZE ≤ MAX_HEADER_SIZE`.

##### Metadata Identifiers

The Metadata Identifiers (`byte`) are a set of boolean switches set by the ASA Metadata
Registry.

The Metadata Identifiers are defined as follows:

|  BIT  | DESCRIPTION                          | DEFAULT | STATE TRANSITION |
|:-----:|:-------------------------------------|:-------:|:-----------------|
| `LSB` | [Short Metadata](#metadata)          | `False` | Two-ways         |
|  `1`  | Not used                             |    -    | -                |
|  `2`  | Not used                             |    -    | -                |
|  `3`  | Not used                             |    -    | -                |
|  `4`  | [ARC-3 Compliant](#arc-3-compliance) | `False` | One-way          |
|  `5`  | Not used                             |    -    | -                |
|  `6`  | Not used                             |    -    | -                |
| `MSB` | [ARC-89](./arc-0089.md) Native ASA   | `False` | One-way          |

The state transition of bits:

- `LSB` is _two-ways_ (reversible),

- `4, MSB` are _one-way_ (irreversible).

The Metadata Identifiers **SHALL NOT** be updated if the Metadata is [_immutable_](#metadata-immutability).

###### Short Metadata

The Metadata **MAY** be identified as _short_ on creation or after, by setting the
`LSB` in the Metadata Identifier to `True`.

Clients **MUST NOT** assume shortness identifier persists across updates, since the
Metadata size is not guaranteed to be constant (if not [_immutable_](#metadata-immutability)).

> If the Metadata is identified as _short_, clients are aware that all AVM opcodes
> can operate directly on the whole Metadata, example: decoding (`json_ref`, `base64_decode`),
> cryptography (`sha256`, `keccak256`, `sha512_256`, `sha3_256`), byte manipulations,
> etc.

> For further details on identification rules, refer to the [Metadata section](#metadata).

###### [ARC-3](./arc-0003.md) Compliant

The Metadata **MAY** be identified as [ARC-3](./arc-0003.md) compliant on creation
by setting the bit `4` in the Metadata Identifier to `True`.

> For further details on identification rules, refer to the [ARC-3 Compliance section](#arc-3-compliance).

###### [ARC-89](./arc-0089.md) Native ASA

The ASA **MAY** be identified as a _native_ [ARC-89](./arc-0089.md) ASA on creation
by setting the `MSB` in the Metadata Identifier to `True`.

> For further details on identification rules, refer to the [Asset URL section](#asset-url).

##### Metadata Flags

The Metadata Flags (`byte`) are reserved for bitwise operations with a bitmask declared
by the ASA Manager Address.

The Metadata Flags are defined as follows:

|  BIT  | DESCRIPTION                                    | DEFAULT | STATE TRANSITION |
|:-----:|:-----------------------------------------------|:-------:|:-----------------|
| `LSB` | [ARC-20](./arc-0020.md) Smart ASA              | `False` | Two-ways         |
|  `1`  | [ARC-62](./arc-0062.md) ASA Circulating Supply | `False` | Two-ways         |
|  `2`  | Reserved for future ARCs                       | `False` | Two-ways         |
|  `3`  | Reserved for future ARCs                       | `False` | Two-ways         |
|  `4`  | Reserved for future ARCs                       | `False` | One-way          |
|  `5`  | Reserved for future ARCs                       | `False` | One-way          |
|  `6`  | Reserved for future ARCs                       | `False` | One-way          |
| `MSB` | Metadata Immutability                          | `False` | One-way          |

The bits `2 ... 6` are reserved for future ARCs and **MUST** be initialized to `False`.

The state transition of bits:

- `LSB ... 3` are _two-ways_ (reversible),

- `4 ... MSB` are _one-way_ (irreversible).

The Metadata Flags **SHALL NOT** be updated if the Metadata is [_immutable_](#metadata-immutability).

###### Smart ASA

An ASA **MAY** be declared to be an [ARC-20](./arc-0020.md) Smart ASA on creation
or after, setting the `LSB` in the Metadata Flags to `True`.

If the ASA is declared to be an [ARC-20](./arc-0020.md) Smart ASA:

- The ASA **MUST** conform with the [ARC-3](#arc-3-compliance) specification, and

- The Metadata **MUST** be used for the ASA Controlling Application discovery, conforming
to the [ARC-20](./arc-0020.md#specifying-the-controlling-smart-contract) specification.

###### ASA Circulating Supply

The [ARC-62](./arc-0062.md) ASA Circulating Supply **MAY** be enabled on creation
or after, setting the bit `1` in the Metadata Flags to `True`.

If the [ARC-62](./arc-0062.md) support is _enabled_:

- The ASA **MUST** conform with the [ARC-3](#arc-3-compliance) specification, and

- The Metadata **MUST** be used for the ASA Circulating Supply Application discovery,
conforming to the [ARC-62](./arc-0062.md#circulating-supply-application-discovery)
specification.

###### Metadata Immutability

The Metadata **MAY** be declared as _immutable_ on creation or after, setting the
`MSB` in the Metadata Flags to `True`.

> ⚠️ WARNING: If the ASA Manager Address is set to the Zero Address, this implies
> that the ASA is effectively _immutable_, regardless of the Metadata Immutability
> flag (`MSB`) setting.

##### Last Modified Round

The Last Modified Round (`uint64`) records the block in which the Metadata Header
or the Metadata was last modified (or created).

> The Last Modified Round is guaranteed to be monotonically increasing.

##### Last Modified Timestamp

The Last Modified Timestamp (`uint64`, seconds) records the <a href="https://en.wikipedia.org/wiki/Unix_time">UNIX
timestamp</a> of the block in which the Metadata Header or the Metadata was last
modified (or created).

> ⚠️ WARNING: The Last Modified Timestamp is _not_ guaranteed to be monotonically
> increasing, and it is _not_ guaranteed to be accurate with respect to external
> time references.

Clients **MUST NOT** use the Last Modified Timestamp to validate Metadata freshness,
the [Last Modified Round](#last-modified-round) **MUST** be used instead.

##### Metadata

The Metadata is a byte-array of variable length (`metadata_size`).

The `MAX_METADATA_SIZE` (`uint16`) is a parameter of the ASA Metadata Registry that
depends on:

- The maximum byte size of an AVM Box `MAX_BOX_SIZE` (`32768` bytes);

- The `HEADER_SIZE`;

Therefore, `MAX_METADATA_SIZE = MAX_BOX_SIZE - HEADER_SIZE = 32750` bytes.

The `metadata_size` **MUST** hold the condition: `metadata_size ≤ MAX_METADATA_SIZE`.

The `AVM_STACK_SLOT_SIZE` (`uint16`) is a parameter of the ASA Metadata Registry
that is equal to the AVM Stack length (`4096` bytes).

If the `metadata_size ≤ AVM_STACK_SLOT_SIZE`, it **MUST** be declared as [_short_](#short-metadata).

The Metadata **MUST NOT** be updated if [_immutable_](#metadata-immutability).

###### Encoding

The Metadata **SHOULD** be a sequence of bytes representing a valid UTF-8 encoded
JSON _object_, as defined in <a href="https://datatracker.ietf.org/doc/html/rfc8259">RFC
8259</a>, without Byte Order Mark (BOM).

If the Metadata is a valid JSON object, it **SHOULD** conform to the [_ARC-3 JSON
Metadata File Schema_](#arc-3-compliance). This is the **RECOMMENDED** schema for
maximum interoperability with the ecosystem (e.g., explorers, wallets, etc.).

###### Pagination

A Metadata Page is a byte-array of variable length (`page_size`) that contains a
portion of (or the entire) Metadata.

The `PAGE_SIZE` (`uint16`) is a parameter of the ASA Metadata Registry that depends
on:

- The AVM size of the `log` opcode `MAX_LOG_SIZE` (`1024` bytes);

- The [ARC-4](./arc-0004.md) return prefix (`151f7c75`) size `ARC4_RETURN_PREFIX_SIZE`
(`4` bytes);

- The maximum [ARC-4](./arc-0004.md) _return type_ encoding overhead: `13` bytes
(for `(bool,uint64,byte[])` tuple, see [Get Metadata interface](#get-metadata));

Therefore, `PAGE_SIZE = MAX_LOG_SIZE - ARC4_RETURN_PREFIX_SIZE - 13 = 1007` bytes.

The `page_size` **MUST** hold the condition `page_size ≤ PAGE_SIZE`.

###### MBR Delta

The _MBR Delta_ is the variation of the ASA Metadata Registry Application Account
MBR due to the creation, update, or deletion of the Asset Metadata Box.

It is a tuple of two elements, encoding:

- The _sign_ (`uint8`) enum:

| ENUM   | VALUE | DESCRIPTION |
|:-------|:-----:|:------------|
| `NULL` |  `0`  | Null        |
| `POS`  |  `1`  | Positive    |
| `NEG`  | `255` | Negative    |

- The _amount_ (`uint64`) of MBR, expressed in microALGO.

The MBR Delta is calculated based on the following contextual information:

- The _existence_ of the Asset Metadata Box for the ASA and,

- The relative byte sizes (`delta_size`) between a _new_ Metadata (`new_metadata_size`)
and the _existing_ Metadata (`metadata_size`, if any).

### ASA Creation

Care has to be taken when creating a _native_ [ARC-89](./arc-0089.md) ASA:

- The _Asset URL_ (`au`) field is defined at ASA creation time, and it is _immutable_,

- The _Asset Metadata Hash_ (`am`) field is defined at ASA creation time, and it
is _immutable_,

- The ASA Manager Address **MUST NOT** be set to the Zero Address on creation. 

#### Asset URL

The _Asset URL_ (`au`) field is used as a _partial_ URI pointing to the Asset Metadata
on the Algorand ledger.

The _Asset URL_ (`au`) **MUST** be the _partial_ [ARC-82](./arc-0082.md) URI:

`algorand://app/<singleton_arc89_app_id>?box=#arc89`

The [Native ARC-89 ASA Identifier](#arc-89-native-asa) **MUST** be set to `True`.

Clients **MUST** resolve the _partial_ Asset URL (`au`) to a _complete_ [Asset Metadata
URI](#asset-metadata-uri) before using it.

> Refer to the [Asset Metadata URI section](#asset-metadata-uri) for details about
> the _complete_ [ARC-82](./arc-0082.md) _Asset Metadata URI_.

#### Asset Metadata Hash

If the Asset Metadata is set as [_immutable_](#metadata-immutability) on creation,
the _Asset Metadata Hash_ (`am`) field **SHOULD** be used as hash-lock invariant.

The _Asset Metadata Hash_ (`am`) **MUST** be the set to:

```plain
am = SHA-512/256("arc0089/am" || Metadata Flags || SHA-512/256(Metadata Raw Bytes))
```

Where:

- `||` denotes concatenation,
- Metadata Flags is the [Metadata Flags](#metadata-flags) field serialized in network
byte order (big-endian),
- Metadata is the [Metadata](#metadata) field (_exact raw bytes_ stored in the box) at
creation,
- SHA-512/256 is defined in <a href="https://doi.org/10.6028/NIST.FIPS.180-4">NIST FIPS 180-4</a>.

Metadata Flags **MUST NOT** be reinterpret as a signed integer, bitset string, or
multi-byte integer prior to hashing.

If the Metadata is identified as [_short_](#short-metadata), the ASA Metadata Registry
**MUST** validate the Asset Metadata Hash and reject the Asset Metadata creation
on validation failure.

#### [ARC-3](./arc-0003.md) Compliance

The compliance with [ARC-3](./arc-0003.md) is **OPTIONAL** but **RECOMMENDED** to maximize
interoperability with the ecosystem.

If the ASA conforms to [ARC-3](./arc-0003.md), then:

- The ASA **MUST** comply with the [_ARC-3 ASA Parameters Conventions_](./arc-0003.md#asa-parameters-conventions)
for the _Asset Name_ (`an`) and the _Asset URL_ (`au`) fields.

  - It is **RECOMMENDED** to use the _Asset URL_ (`au`) suffix option, in this case
  the _partial_ [ARC-82](./arc-0082.md) URI would be: `algorand://app/<singleton_arc89_app_id>?box=#arc3+89`

- If the Metadata are set as _immutable on creation_, the ASA **MUST** comply with
the [_ARC-3 ASA Parameters Conventions_](./arc-0003.md#asa-parameters-conventions)
for the _Asset Metadata Hash_ (`am`) field.

- The Asset Metadata **MUST** comply with the [_ARC-3 JSON Metadata File Schema_](./arc-0003.md#json-metadata-file-schema).

- The [ARC-3 Compliant Identifier](#arc-3-compliant) **MUST** be set to `True`.

Refer to the [Asset Metadata URI section](#asset-metadata-uri) for details about
the _complete_ [ARC-82](./arc-0082.md) _Asset Metadata URI_.

#### Creation Process

Two **RECOMMENDED** creation processes are provided.

##### ARC-89 Native ASA Creation

The **RECOMMENDED** creation process for a [ARC-89 _native_  ASA](#arc-89-native-asa):

1. The ASA Creator Address defines the [Metadata Flags](#metadata-flags) and the
[Metadata](#metadata),

1. The ASA Creator Address creates an ASA as follows:
   - The _Asset URL_ (`au`) field is set to `algorand://app/<singleton_arc89_app_id>?box=#arc89`,
   - If the Asset Metadata is [_immutable_](#metadata-immutability), the _Asset Metadata
   Hash_ (`am`) field is set according to the [Asset Metadata Hash rules](#asset-metadata-hash)
   using the defined Metadata Flags and Metadata (raw bytes),
   - The ASA Manager Address is _not_ set to the Zero Address.

1. The ASA Manager Address creates the Asset Metadata on the ASA Metadata Registry,
using the defined Metadata Flags and Metadata.

##### ARC-89 Native ASA Creation with ARC-3 Compliant Metadata

The **RECOMMENDED** creation process for a [ARC-89 _native_  ASA](#arc-89-native-asa)
with [ARC-3 compliant](#arc-3-compliant) Metadata is:

1. The ASA Creator Address defines the [Metadata Flags](#metadata-flags) and the
[Metadata](#metadata),

1. The ASA Creator Address creates an ASA as follows:
   - The _Asset URL_ (`au`) field is set to `algorand://app/<singleton_arc89_app_id>?box=#arc3+89`,
   - If the Asset Metadata is [_immutable_](#metadata-immutability), the _Asset Metadata
   Hash_ (`am`) field is set according to the [_ARC-3 ASA Parameters Conventions_](./arc-0003.md#asa-parameters-conventions),
   - The ASA Manager Address is _not_ set to the Zero Address.

1. The ASA Manager Address creates the Asset Metadata on the ASA Metadata Registry,
using the defined Metadata Flags and Metadata.

If the ASA configuration (Role-Based Access Control and destroyability) needs to
be locked (by disabling the ASA Manager Address), the Asset Metadata **MUST** be
created first.

### Asset Metadata URI

To get the [ARC-82](./arc-0082.md) _Asset Metadata URI_, clients **SHALL** complete
the _Asset URL_ with the `boxparam` filled with the Asset Metadata Box Name, equal
to the _Asset ID_ (big-endian `uint64` encoded as `base64url`):

`algorand://app/<singleton_arc89_app_id>?box=<base64url_encoded_asset_id>#arc89`

Clients **MUST** encode the Asset Metadata Box Name with `base64url` in [ARC-82](./arc-0082.md)
URIs, and with `base64` when calling Algod API endpoints with `/box?name=` query parameter.

> The _Asset ID_ (`uint64`) used as Asset Metadata Box Name (`boxparam`) in the Asset
> Metadata URI is encoded as `base64url` for two reasons: (1) the Box Name is assumed
> to be raw big-endian 8-bytes encoding a `uint64` and (2) the Algod API requires
> `/box?name=` query parameter to be `base64` encoded, while the URI requires the
> URL-safe `base64url` encoding.

#### Examples

> | Asset ID (`uint64`) | 8-byte big-endian (hex) | Algod `/box?name=` (`base64`) | ARC-82 `box=` (`base64url`, no padding) |
> |--------------------:|:-----------------------:|:-----------------------------:|:---------------------------------------:|
> |                 `0` |   `0000000000000000`    |        `AAAAAAAAAAA=`         |              `AAAAAAAAAAA`              |
> |                 `1` |   `0000000000000001`    |        `AAAAAAAAAAE=`         |              `AAAAAAAAAAE`              |
> |              `2^32` |   `0000000100000000`    |        `AAAAAQAAAAA=`         |              `AAAAAQAAAAA`              |
> |            `2^63−1` |   `7fffffffffffffff`    |        `f/////////8=`         |              `f_________8`              |
>
> The _Asset Metadata URI_ for the ASA `12345` would be:
>
> `algorand://app/<singleton_arc89_app_id>?box=AAAAAAAAMDk#arc89`
>
> The _Asset Metadata URI_ for the [ARC-3](./arc-0003.md) ASA
> `12345` would be:
>
> `algorand://app/<singleton_arc89_app_id>?box=AAAAAAAAMDk#arc3+89`

## Rationale

This ARC standardizes an on-chain, Algod/AVM-addressable metadata source for Algorand
Standard Assets (ASAs).

The design goals are:

1. Direct retrieval without Indexer or external storage for small but important metadata,

1. Predictable costs and limits via a single-box layout and strict pagination caps, and

1. Interoperability with the existing ecosystem through conditional ARCs hooks.

### ASA Metadata Registry Application + ARC-82 URI discovery
By fixing a _singleton_ application per Algorand network and using a partial [ARC-82](./arc-0082.md)
URI in the Asset URL (`au`) field, any client can deterministically compute the query
parameter pointing to the Asset Metadata (`/box?name=` as big-endian _Asset ID_)
and retrieve the metadata through (a) Algod REST API (`GetApplicationBoxByName`)
or (b) direct AVM calls to the ASA Metadata Registry. The standard supports two different
entrypoints for the Metadata discovery and retrieval: the _Asset ID_ (available on
the Algorand ledger) or the _Asset Metadata URI_ (which could be distributed on the
Web or by other external channels).

> Refer to the [Usage section](#usage) for details.

### Metadata Header/Body split
A compact header (Identifiers, Flags, Last-Modified Round/Timestamp) precedes the
body (JSON). The Last-Modified Round provides a monotonic version marker so readers
can detect mid-stream changes; the Timestamp is informational.

### Identifiers vs Flags
The ASA Metadata Registry sets Identifiers (e.g., short-metadata hint, ARC-3 compliance
claim, native ARC-89) while the ASA Manager Address governs Flags (ARC-20, ARC-62,
immutability). One-way transitions (e.g., immutability) are enforced on-chain. This
mirrors ASA trust roles and prevents metadata rewrites after lock.

### Pagination with hard bounds
Metadata pagination is provided for the AVM clients (Algod clients can read entire
Metadata in a single request). A fixed `PAGE_SIZE` keeps each response within AVM
limits. The registry guarantees `len(page) ≤ PAGE_SIZE` and supplies a `has_next`
boolean. AVM clients can read paginated Metadata either _atomically_ (**RECOMMENDED**),
using Group Transactions of Inner Transactions, or with _sequential_ Application
Calls. If the _sequential_ read is used, the Last-Modified Round supports streaming
and parallel fetch with drift detection. A separate pagination head exposes total
metadata size, page size, and total pages for preallocation and progress UIs.

### Hash-lock for immutable Metadata
When the ASA is declared _immutable_ at creation, the Asset Metadata Hash (`am`)
field can commit to the on-chain bytes (domain-separated SHA-512/256 over Flags and
Metadata). This binds the ledger state to a wallet-verifiable hash without requiring
JSON normalization.

### Scope and limits
The registry intentionally caps data to a single box (~32 KiB minus header). Large
artifacts (images, media) remain off-chain; their URIs (e.g., `ipfs://...`, `https://...`)
live in the JSON. This strikes a balance between availability and ledger hygiene,
discouraging chain-as-a-drive patterns.

### Operability
Metadata deletion returns excess MBR; third-party cleanup of metadata for destroyed
ASAs is permitted to prevent abandoned state. Network-specific singleton IDs are
published by the ARC.

## Backwards Compatibility

Backwards compatibility for existing ASA is possible, although they are not identified
as a [ARC-89 native ASA](#arc-89-native-asa).

The ASA Metadata Registry can be used by existing ASA as a fallback option in addition
to the existing URIs requiring external infrastructures (e.g., Indexer, IPFS, etc.).

Since the Asset URL (`au`) field is immutable, the Asset Metadata cannot be discovered
though an ASA look-up. Clients need to acquire the [Asset Metadata URI](#asset-metadata-uri)
from a distribution channel.

## Reference Implementation

### [ARC-4](./arc-0004.md) Interface

```json
{
  "name": "ASA Metadata Registry",
  "desc": "Singleton Application providing ASA metadata via Algod API",
  "methods": [
    {
      "name": "arc89_create_metadata",
      "desc": "Create Asset Metadata for an existing ASA, restricted to the ASA Manager Address",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to create the Asset Metadata for" },
        { "type": "byte", "name": "flags", "desc": "The Metadata Flags. WARNING: if the MSB is True the Asset Metadata is IMMUTABLE" },
        { "type": "byte[]", "name": "payload", "desc": "The Metadata payload (without Header). WARNING: Payload larger than args capacity must be provided with arc89_extra_payload calls in the Group" },
        { "type": "pay", "name": "mbr_delta_payment", "desc": "Payment of the MBR Delta amount (microALGO) for the Asset Metadata Box creation" }
      ],
      "events": [
        {
          "name": "arc89_metadata_created",
          "desc": "Event emitted when Asset Metadata is created",
          "args": [
            { "type": "uint64", "name": "asset_id", "desc": "The Asset ID of the created Asset Metadata" },
            { "type": "uint64", "name": "round", "desc": "Round of the Asset Metadata creation" },
            { "type": "uint64", "name": "timestamp", "desc": "Timestamp of the Asset Metadata creation" },
            { "type": "byte", "name": "flags", "desc": "The Metadata Flags" },
            { "type": "bool", "name": "is_short", "desc": "True if the Asset Metadata is identified as short" },
            { "type": "bool", "name": "is_arc3", "desc": "True if the Asset Metadata is identified as ARC-3 compliant" },
            { "type": "bool", "name": "is_native", "desc": "True if the Asset Metadata is identified as native ARC-89" }
          ]
        }
      ],
      "returns": { "type": "(uint8,uint64)", "desc": "MBR Delta: sign enum, and amount (microALGO)" }
    },
    {
      "name": "arc89_replace_metadata",
      "desc": "Replace mutable Metadata with smaller or equal size payload for an existing ASA, restricted to the ASA Manager Address",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to replace the Asset Metadata for" },
        { "type": "byte[]", "name": "payload", "desc": "The Metadata payload (without Header). WARNING: Payload larger than args capacity must be provided with arc89_extra_payload calls in the Group" }
      ],
      "events": [
        {
          "name": "arc89_metadata_updated",
          "desc": "Event emitted when Asset Metadata is replaced",
          "args": [
            { "type": "uint64", "name": "asset_id", "desc": "The Asset ID of the updated Asset Metadata" },
            { "type": "uint64", "name": "round", "desc": "Round of the Asset Metadata update" },
            { "type": "uint64", "name": "timestamp", "desc": "Timestamp of the Asset Metadata update" },
            { "type": "bool", "name": "is_short", "desc": "True if the Asset Metadata is identified as short" }
          ]
        }
      ],
      "returns": { "type": "(uint8,uint64)", "desc": "MBR Delta: sign enum, and amount (microALGO)" }
    },
    {
      "name": "arc89_replace_metadata_larger",
      "desc": "Replace mutable Metadata with larger size payload for an existing ASA, restricted to the ASA Manager Address",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to replace the Asset Metadata for" },
        { "type": "byte[]", "name": "payload", "desc": "The Metadata payload (without Header). WARNING: Payload larger than args capacity must be provided with arc89_extra_payload calls in the Group" },
        { "type": "pay", "name": "mbr_delta_payment", "desc": "Payment of the MBR Delta amount (microALGO) for the larger Asset Metadata Box replace" }
      ],
      "events": [
        {
          "name": "arc89_metadata_updated",
          "desc": "Event emitted when Asset Metadata is replaced",
          "args": [
            { "type": "uint64", "name": "asset_id", "desc": "The Asset ID of the updated Asset Metadata" },
            { "type": "uint64", "name": "round", "desc": "Round of the Asset Metadata update" },
            { "type": "uint64", "name": "timestamp", "desc": "Timestamp of the Asset Metadata update" },
            { "type": "bool", "name": "is_short", "desc": "True if the Asset Metadata is identified as short" }
          ]
        }
      ],
      "returns": { "type": "(uint8,uint64)", "desc": "MBR Delta: sign enum, and amount (microALGO)" }
    },
    {
      "name": "arc89_delete_metadata",
      "desc": "Delete Asset Metadata for an ASA, restricted to the ASA Manager Address (if the ASA still exists)",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to delete the Asset Metadata for" }
      ],
      "events": [
        {
          "name": "arc89_metadata_deleted",
          "desc": "Event emitted when Asset Metadata is deleted",
          "args": [
            { "type": "uint64", "name": "asset_id", "desc": "The Asset ID of the deleted Asset Metadata" },
            { "type": "uint64", "name": "round", "desc": "Round of the Asset Metadata delete" },
            { "type": "uint64", "name": "timestamp", "desc": "Timestamp of the Asset Metadata deletion" }
          ]
        }
      ],
      "returns": { "type": "(uint8,uint64)", "desc": "MBR Delta: sign enum, and amount (microALGO)" }
    },
    {
      "name": "arc89_extra_payload",
      "desc": "Concatenate extra payload to Asset Metadata head call methods (creation or replacement)",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to provide Metadata extra payload for" },
        { "type": "byte[]", "name": "payload", "desc": "The Metadata extra payload to concatenate" }
      ],
      "returns": { "type": "void" }
    },
    {
      "name": "arc89_set_metadata_flags",
      "desc": "Set Asset Metadata Flags, restricted to the ASA Manager Address",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to set the Metadata Flags for" },
        { "type": "byte", "name": "flags", "desc": "The Metadata Flags. WARNING: bits 4...MSB are irreversible if set to True, MSB set Asset Metadata as IMMUTABLE" }
      ],
      "events": [
        {
          "name": "arc89_metadata_updated_flags",
          "desc": "Event emitted when Asset Metadata Flags are updated",
          "args": [
            { "type": "uint64", "name": "asset_id", "desc": "The Asset ID of the updated Asset Metadata Flags" },
            { "type": "uint64", "name": "round", "desc": "Round of the Asset Metadata Flags update" },
            { "type": "uint64", "name": "timestamp", "desc": "Timestamp of the Asset Metadata Flags update" },
            { "type": "byte", "name": "old_flags", "desc": "The old Metadata Flags" },
            { "type": "byte", "name": "new_flags", "desc": "The new Metadata Flags" }
          ]
        }
      ],
      "returns": { "type": "void" }
    },
    {
      "name": "arc89_set_arc20",
      "desc": "Set ARC-20 Smart ASA support for the ASA, restricted to the ASA Manager Address",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to set ARC-20 support for" },
        { "type": "bool", "name": "flag", "desc": "The Asset ID supports ARC-20" }
      ],
      "events": [
        {
          "name": "arc89_metadata_updated_flags",
          "desc": "Event emitted when Asset Metadata Flags are updated",
          "args": [
            { "type": "uint64", "name": "asset_id", "desc": "The Asset ID of the updated Asset Metadata Flags" },
            { "type": "uint64", "name": "round", "desc": "Round of the Asset Metadata Flags update" },
            { "type": "uint64", "name": "timestamp", "desc": "Timestamp of the Asset Metadata Flags update" },
            { "type": "byte", "name": "old_flags", "desc": "The old Metadata Flags" },
            { "type": "byte", "name": "new_flags", "desc": "The new Metadata Flags" }
          ]
        }
      ],
      "returns": { "type": "void" }
    },
    {
      "name": "arc89_set_arc62",
      "desc": "Set ARC-62 Circulating Supply support for the ASA, restricted to the ASA Manager Address",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to set ARC-62 support for" },
        { "type": "bool", "name": "flag", "desc": "The Asset ID supports ARC-62" }
      ],
      "events": [
        {
          "name": "arc89_metadata_updated_flags",
          "desc": "Event emitted when Asset Metadata Flags are updated",
          "args": [
            { "type": "uint64", "name": "asset_id", "desc": "The Asset ID of the updated Asset Metadata Flags" },
            { "type": "uint64", "name": "round", "desc": "Round of the Asset Metadata Flags update" },
            { "type": "uint64", "name": "timestamp", "desc": "Timestamp of the Asset Metadata Flags update" },
            { "type": "byte", "name": "old_flags", "desc": "The old Metadata Flags" },
            { "type": "byte", "name": "new_flags", "desc": "The new Metadata Flags" }
          ]
        }
      ],
      "returns": { "type": "void" }
    },
    {
      "name": "arc89_set_immutable",
      "desc": "Set Asset Metadata as immutable, restricted to the ASA Manager Address",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to set immutable Asset Metadata for" }
      ],
      "events": [
        {
          "name": "arc89_metadata_updated_flags",
          "desc": "Event emitted when Asset Metadata Flags are updated",
          "args": [
            { "type": "uint64", "name": "asset_id", "desc": "The Asset ID of the updated Asset Metadata Flags" },
            { "type": "uint64", "name": "round", "desc": "Round of the Asset Metadata Flags update" },
            { "type": "uint64", "name": "timestamp", "desc": "Timestamp of the Asset Metadata Flags update" },
            { "type": "byte", "name": "old_flags", "desc": "The old Metadata Flags" },
            { "type": "byte", "name": "new_flags", "desc": "The new Metadata Flags" }
          ]
        }
      ],
      "returns": { "type": "void" }
    },
    {
      "name": "arc89_replace_metadata_slice",
      "desc": "Replace a slice of the Asset Metadata for an ASA with a payload of the same size, restricted to the ASA Manager Address",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to replace the Asset Metadata slice for" },
        { "type": "uint16", "name": "offset", "desc": "The 0-based byte offset within the Metadata" },
        { "type": "uint16", "name": "size", "desc": "The slice bytes size to set" },
        { "type": "byte[]", "name": "payload", "desc": "The slice payload" }
      ],
      "events": [
        {
          "name": "arc89_metadata_updated",
          "desc": "Event emitted when Asset Metadata is replaced",
          "args": [
            { "type": "uint64", "name": "asset_id", "desc": "The Asset ID of the updated Asset Metadata" },
            { "type": "uint64", "name": "round", "desc": "Round of the Asset Metadata update" },
            { "type": "uint64", "name": "timestamp", "desc": "Timestamp of the Asset Metadata update" }
          ]
        }
      ],
      "returns": { "type": "void" }
    },
    {
      "name": "arc89_get_metadata_mbr_delta",
      "desc": "Return the Asset Metadata Box MBR Delta for an ASA, given a new Asset Metadata byte size",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to calculate the Asset Metadata MBR Delta for" },
        { "type": "uint16", "name": "metadata_size", "desc": "The Asset Metadata byte size" }
      ],
      "returns": { "type": "(uint8,uint64)", "desc": "MBR Delta: sign enum, and amount (microALGO)" }
    },
    {
      "name": "arc89_check_metadata_exists",
      "desc": "Checks whether the specified ASA exists and whether its associated Asset Metadata is available",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to check the ASA and Asset Metadata existence for" }
      ],
      "returns": { "type": "(bool,bool)", "desc": "The first value indicates if the ASA exists, and the second indicates if the Asset Metadata exists for that ASA" }
    },
    {
      "name": "arc89_is_arc20_asa",
      "desc": "Return True if the ASA is an ARC-20 Smart ASA, False otherwise",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to check ARC-20 setting for" }
      ],
      "returns": { "type": "(bool,uint64)", "desc": "The first value indicates if the ASA is an ARC-20 ASA, the second is the Metadata Last Modified Round" }
    },
    {
      "name": "arc89_is_arc62_asa",
      "desc": "Return True if the ASA supports ARC-62 Circulating Supply, False otherwise",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to check ARC-62 setting for" }
      ],
      "returns": { "type": "(bool,uint64)", "desc": "The first value indicates if the ASA supports ARC-62 Circulating Supply, the second is the Metadata Last Modified Round" }
    },
    {
      "name": "arc89_is_metadata_immutable",
      "desc": "Return True if the Asset Metadata for an ASA is immutable, False otherwise",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to check the Asset Metadata immutability for" }
      ],
      "returns": { "type": "bool", "desc": "Asset Metadata for the ASA is immutable" }
    },
    {
      "name": "arc89_is_arc3_asa",
      "desc": "Return True if the ASA is ARC-3 Compliant, False otherwise",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to check ARC-3 identification for" }
      ],
      "returns": { "type": "bool", "desc": "The ASA is an ARC-3 ASA" }
    },
    {
      "name": "arc89_is_native_asa",
      "desc": "Return True if the ASA is a native ARC-89 ASA, False otherwise",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to check the ARC-89 native definition for" }
      ],
      "returns": { "type": "bool", "desc": "The ASA is native ARC-89" }
    },
    {
      "name": "arc89_is_metadata_short",
      "desc": "Return True if Asset Metadata for an ASA is short (up to 4096 bytes), False otherwise",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to check the Asset Metadata size classification for" }
      ],
      "returns": { "type": "(bool,uint64)", "desc": "The first value indicates if Asset Metadata for the ASA is short, the second is the Metadata Last Modified Round" }
    },
    {
      "name": "arc89_get_metadata_header",
      "desc": "Return the Asset Metadata Header for an ASA",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to get the Asset Metadata Header for" }
      ],
      "returns": { "type": "(byte,byte,uint64,uint64)", "desc": "Asset Metadata Header (Identifiers, Flags, Last Modified Round, Last Modified Timestamp)" }
    },
    {
      "name": "arc89_get_metadata_pagination",
      "desc": "Return the Asset Metadata pagination for an ASA",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to get the Asset Metadata pagination for" }
      ],
      "returns": { "type": "(uint16,uint16,uint8)", "desc": "The first value is the total Metadata byte size, the second is PAGE_SIZE, and the third is the total number of Metadata pages" }
    },
    {
      "name": "arc89_get_metadata",
      "desc": "Return paginated Asset Metadata (without Header) for an ASA",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to get the Asset Metadata for" },
        { "type": "uint8", "name": "page", "desc": "The 0-based Metadata page number" }
      ],
      "returns": { "type": "(bool,uint64,byte[])", "desc": "The first value indicates if there is a next page, the second is the Metadata Last Modified Round, and the third is the paginated Asset Metadata" }
    },
    {
      "name": "arc89_get_metadata_page_hash",
      "desc": "Return the SHA512-256 of a Metadata page for an ASA",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to get the Asset Metadata page hash for" },
        { "type": "uint8", "name": "page", "desc": "The 0-based Metadata page number" }
      ],
      "returns": { "type": "byte[32]", "desc": "The SHA512-256 of the Metadata page" }
    },
    {
      "name": "arc89_get_metadata_slice",
      "desc": "Return a slice of the Asset Metadata for an ASA",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to get the Asset Metadata slice for" },
        { "type": "uint16", "name": "offset", "desc": "The 0-based byte offset within the Metadata" },
        { "type": "uint16", "name": "size", "desc": "The slice bytes size to return" }
      ],
      "returns": { "type": "byte[]", "desc": "Asset Metadata slice (size limited to PAGE_SIZE)" }
    },
    {
      "name": "arc89_get_metadata_body_hash",
      "desc": "Return the SHA512-256 of Metadata body for an ASA, if identified as short",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to get the Metadata body hash for" }
      ],
      "returns": { "type": "byte[32]", "desc": "The SHA512-256 of the short Metadata body" }
    },
    {
      "name": "arc89_get_metadata_hash",
      "desc": "Return the Asset Metadata Hash for an ASA (if set), otherwise compute the ARC-89 Metadata Hash, if identified as short",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to get the Asset Metadata Hash for" }
      ],
      "returns": { "type": "byte[32]", "desc": "Asset Metadata Hash (am) if set; otherwise computed ARC-89 hash" }
    },
    {
      "name": "arc89_get_metadata_key_value",
      "desc": "Return the JSON Metadata key value for an ASA, if identified as short ",
      "args": [
        { "type": "uint64", "name": "asset_id", "desc": "The Asset ID to get the key value for" },
        { "type": "byte[]", "name": "key", "desc": "The key to fetch" },
        { "type": "uint8", "name": "type", "desc": "The JSON key type (0: JSON String, 1: JSON Uint64, 2: JSON Object)" }
      ],
      "returns": { "type": "byte[]", "desc": "The key's value from valid UTF-8 encoded JSON Metadata (size limited to PAGE_SIZE)" }
    }
  ]
}
```

> Refer to the [AppSpec section](#arc-56-appspec) for the detailed [ARC-56](./arc-0056.md)
> Application Specification of the singleton reference implementation.

##### Create Metadata

To create the Asset Metadata:

- The ASA **MUST** _exist_, and

- The Asset Metadata Box **MUST NOT** _exist_, and

- The authorization **MUST** be restricted to the ASA Manager Address, and

- The provided `flags` (`byte`) size **MUST** be `1`.

The Asset Name (`an`) **MUST** be validated:

  - If it conforms to [ARC-3 ASA Parameters Conventions](./arc-0003.md#asa-parameters-conventions)
  the [ARC-3 Compliant Identifier](#arc-3-compliant) **MUST** be set to `True`.

The Asset URL (`au`) **MUST** be validated:

  - If it conforms to the [Asset URL section](#asset-url) specification, the [ARC-89
    Native ASA Identifier](#arc-89-native-asa) **MUST** be set to `True`.

  - If it is used to declare [ARC-3](./arc-0003.md) compliance, the [ARC-3 Compliant
  Identifier](#arc-3-compliant) **MUST** be set to `True`.

The [Metadata](#metadata) **MUST** be initialized with the provided `payload` value.

If the creation is part of a Group, the [extra payload](#extra-payload) provided
by _later_ transactions for the same `asset_id` **MUST** be concatenated in order.

If the `metadata_size ≤ AVM_STACK_SLOT_SIZE`, the [Short Metadata Identifier](#short-metadata)
**MUST** be set to `True`.

If the Metadata is identified as [_short_](#short-metadata), the Asset Metadata Hash
(`am`) **MUST** be validated:

  - If it does not conform to the [Asset Metadata Hash](#asset-metadata-hash) specification,
  the creation **MUST** be rejected.

The [Metadata Flags](#metadata-flags) **MUST** be initialized with the provided `flags`
value.

The [MBR Delta](#mbr-delta) _amount_ of the created Asset Metadata Box **MUST** be
provided contextually to the ASA Metadata Registry Address.

An `arc89_metadata_created` event **MUST** be emitted.

> ⚠️ WARNING: if the MSB of the Metadata Flags is `True` the Asset Metadata is _immutable_,
> for further details refer to the [Metadata Flags section](#metadata-flags).

##### Replace Metadata

To replace the Asset Metadata for an ASA with smaller or equal size Metadata:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The Asset Metadata **MUST NOT** be _immutable_, and

- The authorization **MUST** be restricted to the ASA Manager Address.

The [Metadata](#metadata) **MUST** be replaced with the provided `payload` value.

If the creation is part of a Group, the [extra payload](#extra-payload) provided
by _later_ transactions for the same `asset_id` **MUST** be concatenated in order.

If the `metadata_size > existing_metadata_size` the update **MUST** be rejected.

If the `metadata_size ≤ AVM_STACK_SLOT_SIZE`, the [Short Metadata Identifier](#short-metadata)
**MUST** be set to `True`.

The [MBR Delta](#mbr-delta) _amount_ of the updated Asset Metadata Box **MUST** be
managed contextually:

- If _sign_ is `NULL`, no MBR management is required;

- If _sign_ is `NEG`, the excess of MBR amount **MUST** be returned from the ASA
Metadata Registry Address to the ASA Manager Address.

An `arc89_metadata_updated` event **MUST** be emitted.

> MBR is returned with an Inner Transaction whose fee is externally provided.

##### Replace Metadata Larger

To replace the Asset Metadata for an ASA with larger size Metadata:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The Asset Metadata **MUST NOT** be _immutable_, and

- The authorization **MUST** be restricted to the ASA Manager Address.

The [Metadata](#metadata) **MUST** be replaced with the provided `payload` value.

If the creation is part of a Group, the [extra payload](#extra-payload) provided
by _later_ transactions for the same `asset_id` **MUST** be concatenated in order.

If the `metadata_size ≤ existing_metadata_size` the update **MUST** be rejected.

If the `metadata_size ≤ AVM_STACK_SLOT_SIZE`, the [Short Metadata Identifier](#short-metadata)
**MUST** be set to `True`.

The [MBR Delta](#mbr-delta) _amount_ of the updated Asset Metadata Box **MUST** be
provided contextually to the ASA Metadata Registry Address.

An `arc89_metadata_updated` event **MUST** be emitted.

##### Delete Metadata

To delete the Asset Metadata for an ASA:

- The Asset Metadata Box **MUST** _exist_, and

- If the ASA still _exists_:

  - The Asset Metadata **MUST NOT** be _immutable_, and 

  - The authorization **MUST** be restricted to the ASA Manager Address.

> ⚠️ WARNING: Not even the ASA Manager Address can delete the _immutable_ Asset Metadata
> of an _existing_ ASA, while anyone can delete Asset Metadata if the ASA has been
> _destroyed_, regardless of being _immutable_ or not.

The Asset Metadata Box **MUST** be deleted.

The [MBR Delta](#mbr-delta) _amount_ of the deleted Asset Metadata Box **MUST** be
managed contextually:

- If the ASA _exists_, it **MUST** be returned to the ASA Manager Address, otherwise

- It **MUST** be returned to the caller.

An `arc89_metadata_deleted` event **MUST** be emitted.

> MBR is returned with an Inner Transaction whose fee is externally provided.

##### Extra Payload

To provide an extra payload to append to Asset Metadata creation or replace for an
ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The authorization **MUST** be restricted to the ASA Manager Address.

The extra payload calls **MUST** appear _after_ the corresponding header call (create
or replace) for that same `asset_id` in the same Group; concatenation order is transaction-index
order.

Total staged bytes per `asset_id` per Group **MUST NOT** exceed `MAX_METADATA_SIZE`.

> The Asset Metadata Box already exists since the extra payload call is always preceded
> by a header call (create or replace).

> The header call (create or replace) checks that the extra payload call is keyed
> to the same Asset ID to manage interleaving and idempotence.
> 
> **Example:** Creating and updating different Assets Metadata in the same Group
>
> ```plain
> [Tx1: Create Payload A, Extra Payload A1, Update Payload B, Extra Payload A2, Extra Payload B1]
> ```
>
> Would result in the following Asset Metadata Boxes:
>
> - Asset ID A: `[Header A, Create Payload A || Extra Payload A1 || Extra Payload A2]`
> - Asset ID B: `[Header B, Update Payload B || Extra Payload B1]`

##### Set Metadata Flags

For the already defined flags (`LSB`, `1`, and `MSB`), it is **RECOMMENDED** to use
the dedicated flag setters instead of this method.

To set the Asset Metadata Flags for an ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The Asset Metadata **MUST NOT** be _immutable_, and

- The authorization **MUST** be restricted to the ASA Manager Address.

The _reversible_ [Metadata Flags](#metadata-flags) `LSB ... 3` **MUST** be set to
the provided `flags` (`byte`) value.

The _irreversible_ [Metadata Flags](#metadata-flags) `4 ... MSB` **MUST** be set
to the provided `flags` (`byte`) value if their current value is `False`, and ignored
otherwise.

An `arc89_metadata_updated_flags` event **MUST** be emitted.

> ⚠️ WARNING: if the 4 ... MSB flags are set to `True` the state transition is _irreversible_,
> for further details refer to the [Metadata Flags section](#metadata-flags).

> ⚠️ WARNING: if the MSB of the Metadata Flags is `True` the Asset Metadata is _immutable_,
> for further details refer to the [Metadata Flags section](#metadata-flags).

##### Set [ARC-20](./arc-0020.md)

To set the [ARC-20](./arc-0020.md) support for the ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The Asset Metadata **MUST NOT** be _immutable_, and

- The authorization **MUST** be restricted to the ASA Manager Address.

The [ARC-20](./arc-0020.md) flag in the [Metadata Flags](#metadata-flags) **MUST**
be set to the provided `flag` (`bool`) value.

An `arc89_metadata_updated_flags` event **MUST** be emitted.

##### Set [ARC-62](./arc-0062.md)

To set the [ARC-62](./arc-0062.md) support for the ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The Asset Metadata **MUST NOT** be _immutable_, and

- The authorization **MUST** be restricted to the ASA Manager Address.

The [ARC-62](./arc-0062.md) flag in the [Metadata Flags](#metadata-flags) **MUST**
be set to the provided `flag` (`bool`) value.

An `arc89_metadata_updated_flags` event **MUST** be emitted.

##### Set Immutable

To set the Asset Metadata as _immutable_:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The Asset Metadata **MUST NOT** be _immutable_, and

- The authorization **MUST** be restricted to the ASA Manager Address.

The Asset Metadata _immutability_ flag in the [Metadata Flags](#metadata-flags)
**MUST** be set to `True`.

An `arc89_metadata_updated_flags` event **MUST** be emitted.

> ⚠️ WARNING: Asset Metadata immutability cannot be revoked once set.

##### Replace Metadata Slice

To replace the Metadata slice for an ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The Asset Metadata **MUST NOT** be _immutable_, and

- The authorization **MUST** be restricted to the ASA Manager Address,

- The byte range specified with `offset` (`uint16`) and `size` (`uint16`) **MUST
NOT** exceed the `metadata_size`, and

- The `payload` byte size **MUST NOT** exceed the Application Calls arguments size
limit, and

- The `payload` byte size **MUST** be equal to `size`.

The Metadata slice **MUST** be replaced with the provided `payload` value.

An `arc89_metadata_updated` event **MUST** be emitted.

##### Get Metadata MBR Delta

To get the [MBR Delta](#mbr-delta) for an ASA:

- If the Asset Metadata Box _exists_, `flat_mbr = 0` and then:

  - If the `new_metadata_size == metadata_size`, then:
    - The returned _sign_ **MUST** be `NULL`, and
    - `delta_size = 0`.

  - If the `new_metadata_size > metadata_size`, then:
    - The returned _sign_ **MUST** be `POS`, and
    - `delta_size = new_metadata_size - metadata_size`.

  - If the `new_metadata_size < metadata_size`, then:
    - The returned _sign_ **MUST** be `NEG`, and
    - `delta_size = metadata_size - new_metadata_size`.

- If the Asset Metadata Box _does not exist_, `flat_mbr = FLAT_MBR` and then:
    - The returned _sign_ **MUST** be `POS`, and
    - `delta_size = box_name_size + HEADER_SIZE + new_metadata_size`.

The returned _amount_ **MUST** be `flat_mbr + BYTE_MBR * delta_size`.

> The _static_ MBR Delta calculation provided to the clients is based on:
>
> - `FLAT_MBR` (`uint64`), a parameter of the ASA Metadata Registry (microALGO) equal
> to AVM MBR for Box creation;
>
> - `BYTE_MBR` (`uint64`), a parameter of the ASA Metadata Registry (microALGO) equal
> to AVM MBR for byte used by the Box.

> The _dynamic_ (**RECOMMENDED**) MBR Delta calculation is provided to the clients
> by simulating the create, update, or delete methods.

##### Check Metadata Exists

The method **MUST** return a pair of booleans (`(bool,bool)`):

- The first value is `True` if the ASA _still exists_, `False` otherwise;

- The second value is `True` if the Asset Metadata for the ASA _exists_, `False` otherwise.

##### Is [ARC-3](./arc-0003.md) ASA

To check if the Asset Metadata is [ARC-3](./arc-0003.md) compliant:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_.

The method **MUST** return the value of the [ARC-3 Compliant](#arc-3-compliant) identifier.

##### Is [ARC-20](./arc-0020.md) ASA

To check if the ASA is an [ARC-20](./arc-0020.md) Smart ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_.

The method **MUST** return the value of the [Smart ASA](#smart-asa) flag and the
Last Modified Round (`uint64`).

##### Is [ARC-62](./arc-0062.md) ASA

To check if the ASA supports [ARC-62](./arc-0062.md) Circulating Supply:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_.

The method **MUST** return the value of the [ASA Circulating Supply](#asa-circulating-supply)
flag and the Last Modified Round (`uint64`).

##### Is Native [ARC-89](./arc-0089.md) ASA

To check if the ASA is a native [ARC-89](./arc-0089.md) ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_.

The method **MUST** return the value of the [ARC-89 Native ASA](#arc-89-native-asa)
identifier.

##### Is Metadata Short

To check if the Asset Metadata is [_short_](#short-metadata):

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_.

The method **MUST** return the value of the [Short Metadata](#short-metadata) identifier
and the Last Modified Round (`uint64`).

##### Is Metadata Immutable

To check if the Asset Metadata is [_immutable_](#metadata-immutability):

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_.

The method **MUST** return `True` if the Asset Metadata for an ASA is _immutable_
or the ASA Manager Address is set to the Zero Address, `False` otherwise.

##### Get Metadata Header

To get the Asset Metadata Header for an ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_.

The Metadata Header **MUST** be returned as a tuple `(byte,byte,uint64,uint64)`, where:

- The first value (`byte`) is the [Metadata Identifiers](#metadata-identifiers),

- The second value (`byte`) is the [Metadata Flags](#metadata-flags),

- The third value (`uint64`) is the [Last Modified Round](#last-modified-round),

- The fourth value (`uint64`) is the [Last Modified Timestamp](#last-modified-timestamp).

##### Get Metadata Pagination

To get the Asset Metadata pagination for an ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_.

The pagination **MUST** be returned as a tuple `(uint16,uint16,uint8)`, where:

- The first value (`uint16`) is the Metadata _total length_ (`metadata_size`, in
bytes),

- The second value (`uint16`) is the `PAGE_SIZE` (in bytes, as defined in the [Metadata
Pagination section](#pagination)),

- The third value (`uint8`) is the total number of Metadata pages (`total_pages`).

> A `uint8` is enough to declare a `page` since `ceil(MAX_METADATA_SIZE/PAGE_SIZE)=33`.

##### Get Metadata

To get the Asset Metadata for an ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_,

- The provided 0-indexed `page` (`uint8`) **MUST NOT** exceed the total number of
Metadata pages.

The paginated Asset Metadata **MUST** be returned as a tuple `(bool,uint64,byte[])`,
where:

- The first value (`bool`) is a flag indicating if the Metadata _has next page_,

- The second value (`uint64`) is the [Last Modified Round](#last-modified-round)
of the Metadata,

- The third value (`byte[]`) is the content of Metadata page with length equal to
`content_size` bytes.

The _has next page_ flag **MUST** be `True` if, at the time of serving the request,
`(page + 1) * PAGE_SIZE < metadata_size`, and `False` otherwise. 

The _content_ byte size **MUST NOT** exceed the `PAGE_SIZE`.

The implementation **MUST** ensure that `content_size ≤ PAGE_SIZE` for every response.

For `page`s `p` where `(p+1)*PAGE_SIZE ≤ metadata_size` at serve time, the response
the implementation **SHOULD** return `content_size = PAGE_SIZE`. The final page **MUST**
return `content_size = metadata_size − PAGE_SIZE*(total_pages−1)`.

> This invariant guarantees the read operation remains within protocol return-size
> limits, enables deterministic computation of total pages and _has next page_, and
> allows client implementations to safely preallocate buffers and parallelize fetches
> without risk of oversized responses.

It is **RECOMMENDED** to group `total_pages` reading in a single _atomic read_ using
a Group Transaction or Inner Transactions.

If the `total_pages` reading is _not atomic_, clients **MUST** verify that [Last
Modified Round](#last-modified-round) remains constant across pages; if it changes,
clients **SHOULD** re-use the `arc89_get_metadata_pagination` method and restart
reading from page `0`. Clients **MAY** simulate the _sequential_ calls to guarantee
atomicity under their own round expectation.

> For further details refer to the [usage section](#usage-mode-2-avm).

##### Get Metadata Page Hash

To get the Metadata Page Hash for an ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_.

The SHA512/256 of `page` content **MUST** be returned.

The Asset Metadata Page Hash **MUST** be returned as:

```plain
SHA-512/256("arc0089/page" || Asset ID || Page Index || Page Content)
```

Where:

- `||` denotes concatenation,
- `Asset ID` is the 8-byte big-endian representation of the Asset ID (`uint64`),
- `Page Index` is encoded as single `uint8` in network byte order,
- `Page Content` are the raw bytes content of Metadata page, unpadded if `len(page) < PAGE_SIZE`.
- SHA-512/256 is defined in <a href="https://doi.org/10.6028/NIST.FIPS.180-4">NIST FIPS 180-4</a>.

##### Get Metadata Slice

To get a Metadata Slice for an ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The byte range specified with `offset` (`uint16`) and `size` (`uint16`) **MUST
NOT** exceed the `metadata_size`, and

- The condition `size ≤ PAGE_SIZE` **MUST** hold.

The slice extracted from the Metadata **MUST** be returned.

##### Get Metadata Body Hash

To get the Metadata Body Hash for an ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The Asset Metadata **MUST** be identified as [_short_](#short-metadata).

The Metadata Body Hash **MUST** be returned as:

```plain
SHA-512/256(Metadata body bytes)
```

Where:

- SHA-512/256 is defined in <a href="https://doi.org/10.6028/NIST.FIPS.180-4">NIST FIPS 180-4</a>.

##### Get Metadata Hash

To get the Metadata Hash for an ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_.

If the Asset Metadata Hash (`am`) field of the ASA is set, it **MUST** be returned,
otherwise:

- The Asset Metadata **MUST** be identified as [_short_](#short-metadata).

- The Asset Metadata Hash **MUST** be computed according the [specification](#asset-metadata-hash)
and returned.

##### Get Metadata Key Value

To get the Metadata Key's Value for an ASA:

- The ASA **MUST** still _exist_, and

- The Asset Metadata Box **MUST** _exist_, and

- The Metadata **MUST** be a valid UTF-8 encoded JSON object, and

- The Asset Metadata **MUST** be identified as [_short_](#short-metadata), and

- The `type` (`uint8`) **MUST** be either `0` (JSON String), `1` (JSON Uint64), or
`2` (JSON Object), and

- The condition key's `value ≤ PAGE_SIZE` **MUST** hold.

The key's value (`byte[]`) from the JSON Metadata object **MUST** be returned.

> ⚠️ WARNING: This getter does not provide pagination or truncation of the returned
> value.

### [ARC-56](./arc-0056.md) AppSpec

TBD

### Usage

The ASA Metadata Registry has two modes of operation:

- **Algod API**: the _entire_ Asset Metadata is retrieved via a single request to
the Algod REST API endpoints (or via SDK wrappers);

- **AVM**: the _paginated_ Asset Metadata is retrieved via _grouped_ (**RECOMMENDED**)
or _sequential_ Application Calls (real or simulated) to the ASA Metadata Registry.

#### Usage Mode 1: Algod API

The Algod clients retrieve the Asset Metadata from two entrypoints:

1. The _Asset ID_;

1. The _Asset Metadata URI_.

> A minimal [Python SDK]() is provided with the reference implementation.

##### Example 1: Get [ARC-3](./arc-0003.md) Metadata from the Asset ID

Given the _Asset ID_ `12345`, the client:

1. Calls the Algod API <a href="https://dev.algorand.co/reference/rest-api/algod/#getassetbyid">GetAssetByID</a>
endpoint to get the _Asset URL_ field (`url`) from the response and drops the `#arc3+89`
suffix (if present), obtaining:

    `algorand://app/<singleton_arc89_app_id>?box=`;

1. Encodes the _Asset ID_ as `base64url` to get the Asset Metadata Box Name (`<base64url_encoded_asset_id>`);

1. Calls the Algod API <a href="https://dev.algorand.co/reference/rest-api/algod/#getapplicationboxbyname">GetApplicationBoxByName</a>
endpoint to get the content of the _Asset Metadata Box_ from the response:

```shell
curl -X GET http://localhost/v2/applications/<singleton_arc89_app_id>/box?name=<base64_encoded_asset_id> \
 -H 'Accept: application/json' \
 -H 'X-Algo-API-Token: API_KEY'
```

The `value` field of the response contains the Asset [ARC-3](./arc-0003.md) JSON
Metadata.

##### Example 2: Get [ARC-3](./arc-0003.md) Metadata from Asset Metadata URI

Given the _Asset Metadata URI_ `algorand://app/<singleton_arc89_app_id>?box=<base64url_encoded_asset_id>#arc3+89`,
the client:

1. Calls the Algod API <a href="https://dev.algorand.co/reference/rest-api/algod/#getapplicationboxbyname">GetApplicationBoxByName</a>
endpoint to get the content of the _Asset Metadata Box_ from the response:

```shell
curl -X GET http://localhost/v2/applications/<singleton_arc89_app_id>/box?name=<base64_encoded_asset_id> \
 -H 'Accept: application/json' \
 -H 'X-Algo-API-Token: API_KEY'
```

The `value` field of the response contains the Asset [ARC-3](./arc-0003.md) JSON
Metadata.

#### Usage Mode 2: AVM

The AVM clients issue Application calls (real or simulated) to the ASA Metadata Registry
in two ways:

1. (**RECOMMENDED**) Atomically, via grouped (Top-level or Inner) Application Calls;

1. Sequentially, via standalone Application Calls;

##### Example 1: Atomic read with Top-level Group

Given the _Asset ID_ `12345`, the client:

1. Call `arc89_get_metadata_pagination` with `asset_id=12345`, ASA Metadata Registry
returns:
   - The total Metadata byte size (`uint16`);
   - The `PAGE_SIZE` (`uint16`), as defined in the [Metadata Pagination section](#pagination);
   - The total Metadata pages `N` (`uint8`).

1. Check that `N ≤ MAX_TXN_PER_GROUP` (currently `16`).

1. Group call `N * arc89_get_metadata` with `asset_id=12345` and `page=0...N-1`
(0-based).

**PROS:**
- Best UX, no delay, atomic fetch guarantees integrity a no data drift.

**CONS:**
- The fetchable `metadata_size` is capped by `MAX_TXN_PER_GROUP` capacity for a Top-level
Group, (while Inner Groups can fetch up to `MAX_METADATA_SIZE`).

##### Example 2: Sequential read, while "has next" page

Given the _Asset ID_ `12345`, the client:

1. Call `arc89_get_metadata` with `asset_id=12345` and `page=0` (0-based), ASA Metadata
Registry returns:
   - A _has next_ (`bool`) flag indicating if more pages exist;
   - The [Last Modified Round](#last-modified-round) monotonic counter;
   - Exactly `PAGE_SIZE` bytes of Metadata (or fewer on the last page), as defined
   in the [Metadata Pagination section](#pagination).

1. While _has next_ page, call `arc89_get_metadata` with `asset_id=12345` and incremented
`page`, verifying Last Modified Round is unchanged.

**PROS:**
- No arithmetic on the caller; just loop while _has next_.

**CONS:**
- Caller doesn’t know the total Metadata length or pages upfront.
- Callers that want progress bars have to either read page `0` first or call the
separate `arc89_get_metadata_pagination` method.

**BEST FOR:**
- Wallets and explorers that stream progressively and don’t care about total Metadata
length until finished.

##### Example 3: Sequential read, two-call pattern

Given the _Asset ID_ `12345`, the client:

1. Call `arc89_get_metadata_pagination` with `asset_id=12345`, ASA Metadata Registry
returns:
   - The total Metadata byte size (`uint16`);
   - The `PAGE_SIZE` (`uint16`), as defined in the [Metadata Pagination section](#pagination);
   - The total Metadata pages `N` (`uint8`).

1. Loop calls `arc89_get_metadata` with `asset_id=12345` and `page=0...N-1` (0-based),
verifying [Last Modified Round](#last-modified-round) is unchanged.

**PROS:**
- Changes of `PAGE_SIZE` in the future won't break readers;
- Improves UX (progress, preallocation).

**CONS:**
- Requires two round trips in the common case.

**BEST FOR:**
- Latency-tolerant clients and SDKs that value clarity and future-proofing.

## Security Considerations

The authorization to create the Asset Metadata and update and delete _mutable_ Asset
Metadata is granted to the ASA Manager Address to preserve the ASA trust model. The
authorization is not granted to the ASA Creator Address, since this role could be
performed programmatically by Applications and is not supposed to be the long-lasting
maintainer of the ASA.

## Copyright

Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.